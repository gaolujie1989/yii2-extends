<?php /** @noinspection ALL */
/**
 * This is the template for generating the openapi class.
 */

use yii\helpers\ArrayHelper;
use yii\helpers\Inflector;

/* @var $this yii\web\View */
/* @var $generator \lujie\extend\gii\generators\openapi\Generator */
/* @var $openapi array openapi */
/* @var $className string Class Name */

$className = $className ?: Inflector::camelize($openapi['info']['title']) . 'Const';

$apiConstants = [];
$schemas = $openapi['components']['schemas'] ?? [];
foreach ($schemas as $key => $schema) {
    $schemaEnums = $schema['enum'] ?? null;
    if (empty($schemaEnums)) {
        continue;
    }
    $schemaConstants = [];
    $constantPrefix = strtoupper(Inflector::underscore($key)) . '_';
    foreach ($schemaEnums as $schemaEnum) {
        if (empty($schemaEnum)) {
            continue;
        }
        $schemaEnumKey = strtr($schemaEnum, ['-' => '_', ':' => '_']);
        if ($schemaEnumKey[0] === strtoupper($schemaEnumKey[0]) && $schemaEnumKey !== strtoupper($schemaEnumKey)) {
            $schemaEnumKey = strtoupper(Inflector::underscore($schemaEnumKey));
        } else {
            $schemaEnumKey = strtoupper(Inflector::underscore(strtolower($schemaEnumKey)));
        }
        $schemaConstants[$constantPrefix . $schemaEnumKey] = $schemaEnum;
    }
    $apiConstants[$key] = $schemaConstants;
}

echo "<?php\n";
?>

namespace <?= $generator->ns ?>;

/**
* This class is autogenerated by the OpenAPI gii generator
*/
class <?= $className . "\n" ?>
{
<?php foreach ($apiConstants as $schemaConstants): ?>
    <?php foreach ($schemaConstants as $constantName => $constantValue): ?>
    public const <?= $constantName ?> = '<?= $constantValue ?>';
    <?php endforeach; ?>
    <?= "\n" ?>
<?php endforeach; ?>
}
