<?php /** @noinspection ALL */
/**
 * This is the template for generating the openapi class.
 */

use yii\helpers\ArrayHelper;
use yii\helpers\Inflector;

/* @var $this yii\web\View */
/* @var $generator \lujie\extend\gii\generators\openapi\Generator */
/* @var $openapi array openapi */
/* @var $className string Class Name */

$className = $className ?: Inflector::camelize($openapi['info']['title']) . 'Const';

$apiConstants = [];
$schemas = $openapi['components']['schemas'] ?? [];
foreach ($schemas as $schemaKey => $schema) {
    $properties = $schema['properties'] ?? null;
    if (empty($properties)) {
        continue;
    }
    [$schemaModel, $schemaModuleVersion] = explode('__', $schemaKey);
    $schemaKey = strtr($schemaModuleVersion, ['-' => '']);
    foreach ($properties as $propertyKey => $property) {
        $propertyEnums = $property['enum'] ?? null;
        if (empty($propertyEnums)) {
            continue;
        }
        $propertyConstants = [];
        $constantPrefix = strtoupper(Inflector::underscore($schemaKey)) . '_' . strtoupper(Inflector::underscore($propertyKey)) . '_';
        foreach ($propertyEnums as $propertyEnumValue) {
            if (empty($propertyEnumValue)) {
                continue;
            }

            $propertyEnumKey = (string)$propertyEnumValue;
            if ($propertyEnumKey[0] === strtoupper($propertyEnumKey[0]) && $propertyEnumKey !== strtoupper($propertyEnumKey)) {
                $propertyEnumKey = strtoupper(Inflector::underscore($propertyEnumKey));
            } else {
                $propertyEnumKey = strtoupper(Inflector::underscore(strtolower($propertyEnumKey)));
            }
            $propertyEnumKey = strtr(trim(preg_replace('/[^a-zA-Z0-9]/', '_', $propertyEnumKey), '_'), ['__' => '_']);
            $propertyConstants[$constantPrefix . $propertyEnumKey] = is_int($propertyEnumValue) ? $propertyEnumValue : "'$propertyEnumValue'";
        }
        $apiConstants[$constantPrefix] = $propertyConstants;
    }
}

echo "<?php\n";
?>

namespace <?= $generator->ns ?>;

/**
* This class is autogenerated by the OpenAPI gii generator
*/
class <?= $className . "\n" ?>
{
<?php foreach ($apiConstants as $propertyConstants): ?>
    <?php foreach ($propertyConstants as $constantName => $constantValue): ?>
    public const <?= $constantName ?> = <?= $constantValue ?>;
    <?php endforeach; ?>
    <?= "\n" ?>
<?php endforeach; ?>
}
